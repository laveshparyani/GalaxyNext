<style>
    {% include "india_compliance/gst_india/print_format/e_waybill/e_waybill.css" %}
</style>

{% set data = _dict(json.loads(doc.data)) %}
{%- set irn = frappe.db.get_value("Sales Invoice", {"ewaybill": data.ewbNo|string}, "irn") -%}

{% if data.supplyType == "O" %}
{% set generated_by = data.fromTrdName %}
{% else %}
{% set generated_by = data.toTrdName %}
{% endif %}

<html lang="en">

<body>
    <div class="page-layout">
        <table class="table borderless no-border">
            <tbody class="table-element">
                <tr>
                    <td colspan="2" class="text-center">
                        <h1 class="title">e-Waybill</h1>
                    </td>
                </tr>

                <tr>
                    <td colspan="2" class="text-center">
                        <img src="data:image/png;base64,{{ get_e_waybill_qr_code(data.ewbNo,data.userGstin, data.ewayBillDate) }}"
                            class="qr-code" />
                    </td>
                </tr>
            </tbody>
        </table>

        <section class="section">
            <table class="table">
                <tbody class="table-element">
                    <tr>
                        <td style="width: 200px">
                            <span>e-Waybill No</span>
                        </td>
                        <td>
                            <span class="e-waybill-number bold">
                                {{ add_spacing(data.ewbNo, 4) }}
                            </span>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <span>e-Waybill Date</span>
                        </td>
                        <td>
                            <span class="bold">
                                {{ data.ewayBillDate | replace("00 ", "") }}
                            </span>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <span>Generated By</span>
                        </td>
                        <td>
                            <span class="bold">
                                {{ add_spacing(data.userGstin, 5) }} - {{ generated_by }}
                            </span>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <span>Valid From</span>
                        </td>
                        <td>
                            <span class="bold">
                                {{ data.ewayBillDate | replace(":00 ", " ") }} {{ " [" }}{{ data.actualDist }}{{ "Kms]" }}
                            </span>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <span>Valid Until</span>
                        </td>
                        <td>
                            <span class="bold">
                                {{ data.validUpto[:10] }}
                            </span>
                        </td>
                    </tr>
                    {% if irn %}
                    <tr>
                        <td>
                            <span>IRN</span>
                        </td>
                        <td>
                            <span class="bold">
                                {{ irn }}
                            </span>
                        </td>
                    </tr>
                    {% endif %}
                </tbody>
            </table>
        </section>

        <section>
            <div>
                <strong>Part - A</strong>
            </div>
            <table class="table custom-margin">
                <tbody class="table-element">
                    <tr>
                        <td style="width: 200px">GSTIN of Supplier</td>
                        <td>
                            <span class="bold">
                                {{ add_spacing(data.fromGstin, 5) }} - {{ data.fromTrdName }}
                            </span>
                        </td>
                    </tr>
                    <tr>
                        <td>Place of Dispatch</td>
                        <td>
                            <span class="bold">
                                {{ data.fromPlace }}, {{ get_state(data.actFromStateCode) }} - {{ data.fromPincode }}
                            </span>
                        </td>
                    </tr>
                    <tr>
                        <td>GSTIN of Recipient</td>
                        <td>
                            <span class="bold">
                                {{ add_spacing(data.toGstin, 5) }} - {{ data.toTrdName }}
                            </span>
                        </td>
                    </tr>
                    <tr>
                        <td>Place of Delivery</td>
                        <td>
                            <span class="bold">
                                {{ data.toPlace }}, {{ get_state(data.actToStateCode) }} -{{ data.toPincode }}
                            </span>
                        </td>
                    </tr>
                    <tr>
                        <td>Document No.</td>
                        <td>
                            <span class="bold">
                                {{ data.docNo }}
                            </span>
                        </td>
                    </tr>
                    <tr>
                        <td>Document Date</td>
                        <td>
                            <span class="bold">
                                {{ data.docDate }}
                            </span>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <span>Transaction Type</span>
                        </td>
                        <td>
                            <span class="bold">
                                {{ get_transport_type(data.transactionType) }}
                            </span>
                        </td>
                    </tr>
                    <tr>
                        <td>Value of Goods</td>
                        <td>
                            <span class="classfont bold">
                                {{ frappe.utils.fmt_money(data.totInvValue, currency="INR") }}
                            </span>
                        </td>
                    </tr>
                    <tr>
                        <td>HSN Code</td>
                        <td>
                            <span class="form-control1 bold" onkeydown="expandtext(this);">
                                {{ data.itemList[0].hsnCode }}
                                    {%if data.itemList[0].productDesc%}
                                    {{ " - " ~data.itemList[0].productDesc }}
                                    {%endif%}
                            </span>
                        </td>
                    </tr>
                    <tr>
                        <td>Reason for Transportation</td>
                        <td>
                            <span class="bold">
                                {{ get_supply_type(data.supplyType) }} - {{ get_sub_supply_type(data.subSupplyType) }}
                            </span>
                        </td>
                    </tr>
                    <tr>
                        <td>Transporter</td>
                        <td>
                            <span class="bold">
                                {{ add_spacing(data.transporterId, 5) }} - {{ data.transporterName }}
                            </span>
                        </td>
                    </tr>
                </tbody>
            </table>
        </section>

        <section>
            {% if data.VehiclListDetails|length > 0 %}
            <div>
                <strong>Part - B</strong>
            </div>
            <table class="table custom-margin">
                <tbody class="table-element">
                    <tr class="bold">
                        <td>Mode</td>
                        <td>
                            Vehicle / Trans <br />
                            Doc No &amp; Dt.
                        </td>
                        <td>From</td>
                        <td>Entered Date</td>
                        <td>Entered By</td>
                        <td>
                            Cdata No. <br />
                            (If any)
                        </td>
                        <td>
                            Multi Veh.Info <br />
                            (If any)
                        </td>
                    </tr>

                    {% for detail in data.VehiclListDetails %}
                    <tr>
                        <td>
                            {{ get_transport_mode(detail.transMode) }}
                        </td>
                        <td>
                            {{ detail.vehicleNo }}
                            {% if detail.transDocNo %}
                               / {{ detail.transDocNo }}
                            {% endif %}
                            {% if detail.transDocDate %}
                                - Dt {{ detail.transDocDate }}
                            {% endif %}
                        </td>
                        <td>{{ detail.fromPlace }}</td>
                        <td>
                            {{ detail.enteredDate |
                            replace(":00 ", " ") }}
                        </td>
                        <td>{{ detail.userGSTINTransin }}</td>
                        <td>-</td>
                        <td>-</td>
                    </tr>
                    {% endfor%}
                </tbody>
            </table>
            {% endif %}
        </section>

        <table class="table no-border text-center">
            <tbody>
                <tr>
                    <td>
                        <div class="middle">
                            <img class="barcode" src="data:image/png;base64,{{ get_ewaybill_barcode(data.ewbNo) }}">
                            <div class="section-separator"></div>
                        </div>
                    </td>
                </tr>
            </tbody>
        </table>
    </div>
</body>

</html>